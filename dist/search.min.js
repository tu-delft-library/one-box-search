function W(f){return(E)=>{let m=`${E}`.split(/\s+/g).filter((j)=>j).map(Z);return(j)=>{f:for(let $ of m){for(let k of f)if($.test(j[k]))continue f;return!1}return!0}}}function Z(f){return new RegExp(`(?:^|[^\\p{L}-])${_(f)}`,"iu")}function _(f){return f.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&")}var D=3,V=[{id:"catalogue",title:{en:"Catalogue",nl:"Catalogus"},description:{en:"Physical and digital books, media, journals",nl:"Fysieke en digitale boeken, media, tijdschriften"},apiBaseUrl:"https://handler.tudelft.nl/worldcat?type=brief&search=",searchBaseUrl:"https://tudelft.on.worldcat.org/search?queryString=",getRecords:async function(f){try{let E=encodeURIComponent(f),m=await A(this.apiBaseUrl+(E||"*"));if(m){let j=m.results;if(j.briefRecords){let $=j.briefRecords.slice(0,D).map((k)=>({id:k.oclcNumber.toString(),title:k.title,authors:k.creator,href:"https://tudelft.on.worldcat.org/oclc/"+k.oclcNumber,date:k.date}));return $.count=j.numberOfRecords,$}else return null}else return null}catch(E){return console.log(E),null}}},{id:"repository",title:{en:"TU Delft Repository",nl:"TU Delft Repository"},description:{en:"Digital archive of TU Delft output",nl:"Digitaal archief van TU Delft output"},apiBaseUrl:"https://repository.tudelft.nl/tudelft/library/search?limit=10&searchterm=",searchBaseUrl:"https://repository.tudelft.nl/search?search_term=",getRecords:async function(f){try{let E=await A(this.apiBaseUrl+encodeURIComponent(f));if(E){let m=E.results,j=+m.total;if(j&&m.searchResults){let $=m.searchResults.slice(0,D).map((k)=>({id:k.thingid.replace("Thing_","uuid:"),title:k.title,authors:k.contributors.map((F)=>F.fullname).join(", "),href:"https://repository.tudelft.nl/record/uuid:"+k.thingid.replace("Thing_",""),date:k.publication_year}));return $.count=j,$}else return null}else return null}catch(E){return console.log(E),null}}},{id:"databases",title:{en:"Databases",nl:"Databases"},description:{en:"Recommended resources for the TU Delft community",nl:"Aanbevolen bronnen voor de TU Delft gemeenschap"},apiBaseUrl:"https://tu-delft-library.github.io/one-box-search/databases.json",searchBaseUrl:"https://databases.tudl.tudelft.nl/?t=az&q=",getRecords:async function(f){try{let E=await A(this.apiBaseUrl);if(E){let m=W(["title","keywords","description"]),j=f?E.results.filter(m(f)):E.results,$=j.slice(0,D).map((k)=>({title:k.title,description:k.description.split(" ").slice(0,25).join(" ")+"...",href:k.url}));return $.count=j.length,$}else return null}catch(E){return console.log(E),null}}},{id:"research-data",title:{en:"Research Data (4TU)",nl:"Research Data (4TU)"},description:{en:"Research datasets, publications, and software",nl:"Onderzoeksdatasets, publicaties en software"},apiBaseUrl:"https://data.4tu.nl/v2/articles/search",searchBaseUrl:"https://data.4tu.nl/search?search=",getRecords:async function(f){try{let E=await A(this.apiBaseUrl,{search_for:f});if(E){let m=E.results;if(m){let j=m.slice(0,D).map((k)=>({id:k.doi,title:k.title,authors:k.authors.map((F)=>F.full_name).join(", "),href:"https://doi.org/"+k.doi,date:k.published_date})),$=E.headers.get("Number-Of-Records");return j.count=$?+$:void 0,j}else return null}else return null}catch(E){return console.log(E),null}}},{id:"special-collections",title:{en:"Special Collections",nl:"Bijzondere Collecties"},description:{en:"Academic heritage, Trésor, Map room",nl:"Academisch erfgoed, Trésor, kaartenkamer"},apiBaseUrl:"https://63flhve71t2un5xgp.a1.typesense.net/multi_search?x-typesense-api-key=8EOitKCMTbxUKPZNqUEoQS9M2RGvpkZS",searchBaseUrl:"https://heritage.tudelft.nl/nl/search?production-manifests%5Bquery%5D=",getRecords:async function(f){try{let E=await A(this.apiBaseUrl,{searches:[{query_by:"label,summary,type,plaintext,topic_material,topic_date,topic_contributor,topic_format",highlight_fields:"label,summary",highlight_start_tag:"<mark>",highlight_end_tag:"</mark>",highlight_full_fields:"label,summary,type,plaintext,topic_material,topic_date,topic_contributor,topic_format",collection:"production-manifests",q:f,facet_by:"topic_contributor,topic_date,topic_format,topic_material,type",max_facet_values:10,page:1}]});if(E){let m=E.results;if(m){let j=m.results[0].hits.slice(0,D).map(({document:$})=>({id:$.slug,title:$.label,authors:$.topic_contributor?$.topic_contributor.join(", "):null,href:"https://heritage.tudelft.nl/"+$.slug,date:$.topic_date?$.topic_date[0]:void 0}));return j.count=m.results[0].found,j}else return null}else return null}catch(E){return console.log(E),null}}}];var K=(f,...E)=>String.raw({raw:f},...E),X=void 0,L=(f)=>X==="nl"?f.nl:f.en;function A(f,E){let m=E?"POST":"GET",j=new Headers,$={method:m,headers:j};if(j.append("Accept","application/json"),E)j.append("Content-Type","application/json"),$.body=JSON.stringify(E);let k=new Request(f,$);return fetch(k).then((F)=>{if(F.ok){let{headers:M}=F;return F.json().then((O)=>({headers:M,results:O}))}else return null})}function g(f){return K`
    <a
      href="${f.href}"
      title="${f.title}"
      target="_blank"
      class="news-summary"
    >
      <section>
        <h3>${f.title}</h3>
        <div class="row">
          <div class="sm-3"></div>
          <div class="sm-9">
            ${f.authors?"<p>"+f.authors+"</p>":""}
            ${f.description?"<p>"+f.description+"</p>":""}
            ${f.date?"<p>Published "+f.date+"</p>":""}
            ${f.id?`<div class="fake-link">${f.id}</div>`:""}
          </div>
        </div>
      </section>
    </a>
  `}function G(f,E,m,j,$){return K`
    <div class="t3ce frame-type-gridelements_pi1">
      <div class="grid-background--white grid-background--boxed">
        ${m&&m.length&&j?j.toLocaleString()+" "+L({en:"results",nl:"resultaten"}):m&&m.length?L({en:"Top 3 results",nl:"Top 3 resultaten"}):L({en:"No results",nl:"Geen resultaten"})}
        <h2>${L(f)}</h2>
        <p><i>${L(E)}</i></p>
        <div class="content-container">
          ${m&&m.length?m.map(g).join(`
`):""}
          <div class="t3ce frame-type-sitetud_singlebutton">
            <a
              href="${$}"
              target="_blank"
              class="btn btn--single align-center btn--royal_blue"
            >
              ${L({en:"View all results ↗",nl:"Bekijk alle resultaten ↗"})}
            </a>
          </div>
        </div>
      </div>
    </div>
  `}var P=()=>{return K`<div
    class="t3ce frame-type-text"
    style="margin-bottom:-20px;margin-top:15px;"
  >
    ${L({en:"Search gives results from",nl:"Zoeken geeft resultaten uit"})}
    <a href="#website"
      ><b>${L({en:"this website",nl:"deze website"})}</b></a
    >,
    ${V.map(({id:f,title:E})=>K`<a href="#${f}"><b>${L(E)}</b></a>`).join(", ")}.
  </div>`};async function Y(f,E){X=E;let m=document.querySelector(".multiRowGrid");if(m){let j=document.querySelector("div.hiddenSidebarContent");if(j){let $=j.innerHTML.split("</form>")[1].trim(),k=P();j.innerHTML=j.innerHTML.split("</form>")[0]+k;let F=m.querySelector(".sm-12");if(F){F.id="website";let M=F.querySelector("h2");if(M){M.textContent=L({en:"This website",nl:"Deze website"});let N=document.createElement("p");N.style.fontStyle="italic",N.innerText=L({en:"Guidelines, tools, events, news",nl:"Richtlijnen, hulpmiddelen, evenementen en nieuwsberichten"}),M.after(N)}let O=F.querySelector(".btn");if(O)O.textContent=L({en:"View all results",nl:"Bekijk alle resultaten"});F.prepend($?$:L({en:"No results",nl:"Geen resultaten"}))}}V.forEach(async($,k)=>{let F=document.createElement("div");if(F.className="sm-6 md-6 lg-6",F.id=$.id,F.innerHTML=K`
        <div class="t3ce frame-type-gridelements_pi1">
          <div class="grid-background--white grid-background--boxed">
            <span style="color:white">-</span>
            <h2>${L($.title)}</h2>
            <i>${L({en:"Loading...",nl:"Aan het laden..."})}</i>
          </div>
        </div>
      `,k===0)m.prepend(F);else m.append(F);let M=await $.getRecords(f),O=G($.title,$.description,M,M?.count,$.searchBaseUrl+encodeURIComponent(f));F.innerHTML=O})}}window.onload=()=>{let{value:f}=document.querySelector(".searchForm-input"),E=document.documentElement.lang||"en";document.documentElement.style.setProperty("scroll-behavior","smooth"),Y(f,E)};
